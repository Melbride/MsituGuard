<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MsituGuard Â· Fire Risk</title>
  <link rel="stylesheet" href="/static/risk/styles.css" />
</head>
<body>
  <header>
    <h1>ðŸ”¥ MsituGuard â€” Fire Risk</h1>
    <nav>
      <a href="/">Now</a>
      <a href="/history/">History</a>
      <a href="/admin/">Admin</a>
    </nav>
  </header>

  <main>
    {% if not has_location %}
      <section class="card">
        <h2>Detect your location</h2>
        <p>Click the button to use your device's location and compute current fire risk.</p>
        <button id="detectBtn">Use my location</button>
        <p class="muted">We only use your coordinates for the prediction â€” nothing is stored until you request a prediction.</p>
      </section>
    {% endif %}

    {% if prediction %}
      <section class="card">
        <h2>Current Fire Risk</h2>
        <div class="risk-banner" style="background: {{prediction.color}}20; border-color: {{prediction.color}};">
          <div class="risk-chip" style="background: {{prediction.color}}">{{prediction.level}}</div>
          <div class="risk-score">Score: {{prediction.score}}</div>
          <div class="risk-meta">
            <span>Lat: {{prediction.lat|floatformat:3}}</span>
            <span>Lon: {{prediction.lon|floatformat:3}}</span>
            <span>As of: {{prediction.timestamp}}</span>
          </div>
        </div>
        <div class="grid">
          <div class="tile">
            <h3>Weather</h3>
            <ul>
              <li>Temp: {{prediction.weather.temp_c}} Â°C</li>
              <li>Humidity: {{prediction.weather.humidity}} %</li>
              <li>Wind: {{prediction.weather.wind_speed_ms}} m/s</li>
              <li>Rain (24h est.): {{prediction.weather.rainfall_mm_24h}} mm</li>
            </ul>
          </div>
          <div class="tile">
            <h3>Vegetation (NDVI)</h3>
            {% if prediction.ndvi %}
              <p>NDVI: {{prediction.ndvi|floatformat:3}}</p>
            {% else %}
              <p>NDVI: <em>Not available (enable GEE later)</em></p>
            {% endif %}
          </div>
          <div class="tile">
            <h3>Recent Fires</h3>
            <p>Within 25 km (7 days): <strong>{{prediction.recent_fires}}</strong></p>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Community Report</h2>
        <form action="/report/" method="post">
          {% csrf_token %}
          {{ report_form.as_p }}
          <button type="submit">Submit Report</button>
        </form>
      </section>
    {% endif %}
  </main>

  <script src="/static/risk/main.js"></script>
</body>
</html>
